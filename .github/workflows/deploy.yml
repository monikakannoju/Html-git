name: ðŸš€ Deploy Static Website to VM (Docker + Nginx)

on:
  push:
    branches:
      - main  # Trigger when you push to main branch

jobs:
  deploy:
    name: Build & Deploy Static Website
    runs-on: ubuntu-latest

    env:
      SERVER_IP: 135.235.195.123     # your VMâ€™s IP
      SERVER_USER: user_1            # your VM username

    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    - name: ðŸ³ Set up Docker (on runner)
      uses: docker/setup-buildx-action@v3

    - name: ðŸ”‘ Setup SSH Key for Deployment
      run: |
        eval "$(ssh-agent -s)"
        echo "${{ secrets.SSH_PRIVATE_KEY }}" | tr -d '\r' | ssh-add -
        mkdir -p ~/.ssh
        ssh-keyscan -H $SERVER_IP >> ~/.ssh/known_hosts

    - name: ðŸ“¦ Deploy Static Website to VM
      run: |
        ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP << 'EOF'
        set -e

        echo "ðŸ”¹ Creating deployment directory..."
        mkdir -p /home/$USER/static-site
        cd /home/$USER/static-site

        echo "ðŸ”¹ Cleaning old container (if any)..."
        docker stop static-site || true
        docker rm static-site || true

        echo "ðŸ”¹ Copying new files..."
        rm -rf *
        # Copy your static site from repo
        cat > index.html <<'HTML'
        <!DOCTYPE html>
        <html>
        <head>
          <title>Static Site Deployed via GitHub Actions</title>
        </head>
        <body>
          <h1>Hello from CI/CD Pipeline ðŸš€</h1>
          <p>Deployed successfully on $(hostname)</p>
        </body>
        </html>
        HTML

        echo "ðŸ”¹ Creating Dockerfile..."
        cat > Dockerfile <<'DOCKER'
        FRO
